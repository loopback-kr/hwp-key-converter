# 한글 2020 및 2022 제품키 자동 입력 및 업데이트 통합 기술문서

* 한글 2020 및 2022 설치 시 제품키 입력 및 최신 업데이트를 자동으로 설치하기 위한 스크립트 작성 방법에 대해 설명합니다.

## 개요

한글 2018의 제품키는 한글 2020에서도 호환되는 것으로 확인됩니다.

과거 한글 2010 제품의 마이너 업그레이드가 SE, SE+ 이고 2014의 마이너 업그레이드가 2014 VP 인것을 감안했을 때 한글 2018의 마이너 업그레이드 버전은 2020인 것 같습니다. 크게 달라진 점이 없고 제품 지원 기간이 2026년으로 동일합니다.

한컴에서는 한글 제품을 설치할 때 제품키 입력을 요청하는 대화상자에서 키를 자동으로 입력하기 위한 옵션을 제공해왔습니다.

한글 2018까지만 해도 설치 패키지의 Install\InstallerConfig.ini에서 [Install] 섹션에 PIDKEY=XXXXX-XXXXX-XXXXX-XXXXX 를 입력하면 간단하게 구현할 수 있었지만, 제품키를 평문으로 저장하기 때문에 이를 보안 이슈로 판단하여 이 기능을 끄고 변환된 제품키인 ECDATA를 기본값으로 변경한 것으로 판단됩니다. 참조: <https://blog.naver.com/musha3630/221671899762> / <https://blog.naver.com/musha3630/221870027649>

기존 PIDKEY에서 지정했던 제품키를 ECDATA 키로 변환하는 과정이 관건인데, 변환된 값을 얻기위한 함수를 구현하기 위해 일단 PIDKEY - ECDATA 쌍을 얻는 것이 우선이였습니다. 이건 제조사에서 체험판으로 주는 패키지에 존재할 것 같아 현재 체험판으로 제공하고 있는 한글 2022 제품을 다운받아 InstallerConfig.ini를 분석했습니다.

해당 파일에 존재하는 ECDATA 값은 기존 PIDKEY를 변환한 값으로 추정됩니다.

이 값을 변환한 원래값. 즉, PIDKEY 값을 얻어내야합니다. 이 제품키는 2022 평가판용이므로 2020 인스톨러에서는 키가 잘못됬다고 인식할 것입니다. 2020 패키지의 InstallerConfig.ini에 ECDATA 값을 넣고 2020 인스톨러를 실행하면 PIDKEY 값이 변환되어 나오게 됩니다.

하이픈을 제외한 두 키의 문자 갯수가 동일합니다. 또, 문자가 존재하는 자리, 숫자가 존재하는 자리가 동일합니다. 하이픈을 기준으로 네개의 서브키는 각각 ECDATA의 3번째, 1번째, 4번째, 2번째 서브키로 할당되었습니다. 그리고 문자별로, 숫자별로 얼마씩 더하면 변환된 값이 됩니다. 9 그리고 Z를 넘어가는 오버플로우는 다시 0, A로 돌아가네요.

이제 가지고 있는 제품키를 ECDATA 키로 변환하고 이를 InstallerConfig.ini에 저장하면 인스톨러 실행 시 자동으로 키가 입력된 상태로 남게 됩니다.

하지만, 한글 2020의 경우 그 상태에서 키의 유효성 검사가 자동으로 이뤄지지 않아서 키 입력 상자에 키보드 입력이 가해져야만 합니다. 그래서 LevelOption을 통해 자동 설치를 하는 것이 좋을 것 같습니다. 한글 2022는 자동으로 이뤄집니다.

<https://www.hancom.com>에서는 제품 업데이트 파일을 무료로 다운로드할 수 있도록 링크를 제공하고 있습니다. 최신 파일을 다운로드 받아 Install 폴더에 저장하고, InstallerConfig.ini에 아래 형식으로 업데이트 파일 경로를 지정합니다.

```ini
[Install]

NoRestart=1


[PostInstall]

ExtRun0=Install\HOffice2020Update_20220119.exe

ExtRunParam0=/silent
```

이런식으로 작성하면 설치가 끝난 후 자동으로 패치를 시작합니다. 단, IE가 실행중일 경우 IE종료안내메시지 없이 업데이트프로그램이 종료됩니다.

## Convert to EXE

* `pyinstaller --onefile --icon=favicon.ico --name HWP-KEY-CONVERTER.exe main.py`
